<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>長輩數學練習產生器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }

        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            body {
                background-color: white !important;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            .a4-page {
                box-shadow: none !important;
                margin: 0 !important;
                width: 210mm !important;
                height: 297mm !important;
                padding: 15mm !important;
                page-break-after: always;
                position: relative;
                overflow: hidden;
            }
            .print-container {
                width: 210mm !important;
                margin: 0 auto !important;
            }
            /* 確保圖片在列印時顯示彩色與細節 */
            img {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 2rem auto;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            padding: 20mm;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb;
            border-radius: 50%;
            cursor: pointer;
        }

        .op-btn.active {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #2563eb;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        }

        .difficulty-card.active {
            background-color: #eff6ff;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- 導覽列 (Web 顯示用) -->
    <nav class="bg-white border-b sticky top-0 z-50 no-print px-6 py-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-4">
            <!-- 網頁最上方 Logo -->
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTN49SX0y6kDNLFOnqemB60ZNlwNYVuOUYFxg&s" alt="Logo" class="h-10 w-auto rounded shadow-sm">
            <h1 class="text-xl font-black tracking-tight text-slate-800">長輩數學練習產生器</h1>
        </div>
        <div class="flex gap-3">
            <button id="backBtn" class="hidden px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-md transition-colors font-medium">
                修改設定
            </button>
            <button id="printBtn" class="hidden flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 shadow-lg transition-all active:scale-95">
                <i data-lucide="printer" size="18"></i> 列印 / 儲存 PDF
            </button>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-6">
        <!-- 設定區域 -->
        <div id="configSection" class="bg-white rounded-3xl shadow-2xl p-8 border border-slate-100 max-w-2xl mx-auto transition-all duration-500">
            <div class="flex items-center gap-3 mb-8 border-b pb-4">
                <i data-lucide="settings" class="text-blue-500"></i>
                <h2 class="text-2xl font-bold">自訂練習題</h2>
            </div>

            <div class="space-y-8">
                <!-- 運算類型 -->
                <div>
                    <label class="block text-sm font-bold text-slate-500 mb-4 uppercase tracking-widest">選擇運算類型 (可複選)</label>
                    <div class="grid grid-cols-4 gap-4" id="opContainer">
                        <button onclick="toggleOp('+')" class="op-btn active h-16 text-3xl font-bold rounded-2xl border-2 border-slate-200 transition-all hover:border-blue-300">+</button>
                        <button onclick="toggleOp('-')" class="op-btn h-16 text-3xl font-bold rounded-2xl border-2 border-slate-200 transition-all hover:border-blue-300">-</button>
                        <button onclick="toggleOp('×')" class="op-btn h-16 text-3xl font-bold rounded-2xl border-2 border-slate-200 transition-all hover:border-blue-300">×</button>
                        <button onclick="toggleOp('÷')" class="op-btn h-16 text-3xl font-bold rounded-2xl border-2 border-slate-200 transition-all hover:border-blue-300">÷</button>
                    </div>
                </div>

                <!-- 難度選擇 -->
                <div>
                    <label class="block text-sm font-bold text-slate-500 mb-4 uppercase tracking-widest">選擇難度</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div onclick="setDifficulty('easy')" id="diff-easy" class="difficulty-card active p-5 rounded-2xl border-2 border-slate-200 cursor-pointer transition-all hover:border-blue-200">
                            <div class="font-black text-lg text-slate-800">基礎</div>
                            <div class="text-sm text-slate-500 mt-1">數字 1-20<br>適合新手練習</div>
                        </div>
                        <div onclick="setDifficulty('medium')" id="diff-medium" class="difficulty-card p-5 rounded-2xl border-2 border-slate-200 cursor-pointer transition-all hover:border-blue-200">
                            <div class="font-black text-lg text-slate-800">進階</div>
                            <div class="text-sm text-slate-500 mt-1">數字 10-99<br>標準兩位數計算</div>
                        </div>
                        <div onclick="setDifficulty('hard')" id="diff-hard" class="difficulty-card p-5 rounded-2xl border-2 border-slate-200 cursor-pointer transition-all hover:border-blue-200">
                            <div class="font-black text-lg text-slate-800">挑戰</div>
                            <div class="text-sm text-slate-500 mt-1">數字 100-999<br>適合熟練的長輩</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- 份數 -->
                    <div>
                        <label class="block text-sm font-bold text-slate-500 mb-4 uppercase tracking-widest">產生份數：<span id="copiesVal" class="text-blue-600">1</span> 份</label>
                        <input type="range" id="copiesInput" min="1" max="10" value="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeVal('copiesInput', 'copiesVal')">
                    </div>

                    <!-- 題數 -->
                    <div>
                        <label class="block text-sm font-bold text-slate-500 mb-4 uppercase tracking-widest">每頁題數</label>
                        <select id="questionsInput" class="w-full p-4 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none bg-slate-50 font-bold">
                            <option value="10">10 題 (超大字體)</option>
                            <option value="20" selected>20 題 (標準配置)</option>
                            <option value="30">30 題 (密集練習)</option>
                        </select>
                    </div>
                </div>

                <!-- 答案頁開關 -->
                <div class="flex items-center gap-4 p-5 bg-slate-50 rounded-2xl cursor-pointer select-none" onclick="toggleAnswer()">
                    <div id="answerCheckbox" class="w-7 h-7 rounded-lg border-2 border-blue-600 bg-blue-600 flex items-center justify-center transition-all">
                        <i id="checkIcon" data-lucide="check" class="text-white" size="18"></i>
                    </div>
                    <span class="font-bold text-slate-700 text-lg">同時產生答案頁 (附在最後)</span>
                </div>

                <button onclick="generate()" class="w-full py-6 bg-blue-600 text-white rounded-2xl text-2xl font-black shadow-xl hover:bg-blue-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3">
                    <i data-lucide="refresh-cw"></i> 產生練習卷
                </button>
            </div>
        </div>

        <!-- 預覽區域 -->
        <div id="previewSection" class="hidden">
            <div id="worksheetContainer" class="print-container">
                <!-- JavaScript 會在此填入內容 -->
            </div>
        </div>
    </main>

    <script>
        // 初始化圖示
        lucide.createIcons();

        // 定義全域 Logo URL
        const logoUrl = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTN49SX0y6kDNLFOnqemB60ZNlwNYVuOUYFxg&s";

        // 應用程式狀態
        let config = {
            operations: ['+'],
            difficulty: 'easy',
            questionsPerPage: 20,
            copies: 1,
            showAnswers: true
        };

        const difficultyMap = {
            easy: { min: 1, max: 20, label: '基礎 (1-20)' },
            medium: { min: 10, max: 99, label: '進階 (10-99)' },
            hard: { min: 100, max: 999, label: '挑戰 (100-999)' }
        };

        // UI 互動函數
        function toggleOp(op) {
            const index = config.operations.indexOf(op);
            if (index > -1) {
                if (config.operations.length > 1) {
                    config.operations.splice(index, 1);
                }
            } else {
                config.operations.push(op);
            }
            updateOpUI();
        }

        function updateOpUI() {
            const btns = document.querySelectorAll('.op-btn');
            btns.forEach(btn => {
                if (config.operations.includes(btn.innerText)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function setDifficulty(diff) {
            config.difficulty = diff;
            document.querySelectorAll('.difficulty-card').forEach(card => card.classList.remove('active'));
            document.getElementById(`diff-${diff}`).classList.add('active');
        }

        function updateRangeVal(inputId, valId) {
            const val = document.getElementById(inputId).value;
            document.getElementById(valId).innerText = val;
            config.copies = parseInt(val);
        }

        function toggleAnswer() {
            config.showAnswers = !config.showAnswers;
            const checkbox = document.getElementById('answerCheckbox');
            if (config.showAnswers) {
                checkbox.classList.add('bg-blue-600', 'border-blue-600');
                checkbox.innerHTML = '<i data-lucide="check" class="text-white" size="18"></i>';
            } else {
                checkbox.classList.remove('bg-blue-600', 'border-blue-600');
                checkbox.innerHTML = '';
            }
            lucide.createIcons();
        }

        function generate() {
            config.questionsPerPage = parseInt(document.getElementById('questionsInput').value);
            
            const container = document.getElementById('worksheetContainer');
            container.innerHTML = '';

            for (let c = 0; c < config.copies; c++) {
                const problems = [];
                const { min, max } = difficultyMap[config.difficulty];

                for (let i = 0; i < config.questionsPerPage; i++) {
                    const op = config.operations[Math.floor(Math.random() * config.operations.length)];
                    let num1, num2, answer;

                    if (op === '+') {
                        num1 = Math.floor(Math.random() * (max - min + 1)) + min;
                        num2 = Math.floor(Math.random() * (max - min + 1)) + min;
                        answer = num1 + num2;
                    } else if (op === '-') {
                        num1 = Math.floor(Math.random() * (max - min + 1)) + min;
                        num2 = Math.floor(Math.random() * (num1 - min + 1)) + min; 
                        answer = num1 - num2;
                    } else if (op === '×') {
                        const mMax = config.difficulty === 'easy' ? 9 : (config.difficulty === 'medium' ? 20 : 99);
                        num1 = Math.floor(Math.random() * (mMax - 2 + 1)) + 2;
                        num2 = Math.floor(Math.random() * 9) + 2;
                        answer = num1 * num2;
                    } else if (op === '÷') {
                        const q = Math.floor(Math.random() * 9) + 2;
                        num2 = Math.floor(Math.random() * 9) + 2;
                        num1 = q * num2;
                        answer = q;
                    }
                    problems.push({ num1, num2, op, answer });
                }

                // 建立題目頁
                container.innerHTML += createSheetHtml(c + 1, problems);

                // 建立答案頁
                if (config.showAnswers) {
                    container.innerHTML += createAnswerHtml(c + 1, problems);
                }
            }

            document.getElementById('configSection').classList.add('hidden');
            document.getElementById('previewSection').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('printBtn').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function createSheetHtml(index, problems) {
            const gridClass = config.questionsPerPage <= 10 ? 'grid-cols-1 gap-12' : 'grid-cols-2 gap-x-12 gap-y-10';
            const fontSize = config.questionsPerPage <= 10 ? 'text-5xl' : 'text-3xl';

            return `
                <div class="a4-page">
                    <div class="border-b-4 border-black pb-4 mb-10 flex justify-between items-end">
                        <!-- 列印時左上角的 Logo -->
                        <div class="flex items-center gap-4">
                            <img src="${logoUrl}" alt="Logo" class="h-16 w-auto rounded shadow-sm">
                            <div>
                                <h3 class="text-4xl font-black mb-1 text-slate-900">數學練習卷 <span class="text-blue-600">#${index}</span></h3>
                                <p class="text-slate-500 font-bold italic">難度：${difficultyMap[config.difficulty].label}</p>
                            </div>
                        </div>
                        <div class="text-right space-y-4">
                            <div class="text-2xl border-b-2 border-black pb-1 w-56 font-bold">姓名：</div>
                            <div class="text-2xl border-b-2 border-black pb-1 w-56 font-bold">日期：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;月&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日</div>
                        </div>
                    </div>

                    <div class="grid ${gridClass} flex-grow">
                        ${problems.map((p, i) => `
                            <div class="flex items-center ${fontSize} font-bold">
                                <span class="w-14 text-slate-300 text-xl font-normal">(${i + 1})</span>
                                <div class="flex-1 flex justify-between items-center bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <span class="tabular-nums">${p.num1} ${p.op} ${p.num2} = </span>
                                    <div class="w-32 h-px border-b-4 border-slate-300 translate-y-4"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="mt-auto pt-8 text-center text-slate-400 italic font-medium">
                        多思考、多練習，腦袋更靈活！
                    </div>
                </div>
            `;
        }

        function createAnswerHtml(index, problems) {
            return `
                <div class="a4-page">
                    <div class="border-b-4 border-slate-300 pb-4 mb-10 flex items-center gap-4">
                        <!-- 列印時答案頁左上角的 Logo -->
                        <img src="${logoUrl}" alt="Logo" class="h-12 w-auto opacity-70 grayscale rounded">
                        <h3 class="text-3xl font-black text-slate-700">答案頁 <span class="text-blue-500">#${index}</span></h3>
                    </div>
                    <div class="grid grid-cols-5 gap-6">
                        ${problems.map((p, i) => `
                            <div class="border-2 border-slate-100 p-4 rounded-xl flex flex-col items-center">
                                <span class="text-slate-400 text-sm mb-1">${i + 1}</span>
                                <span class="text-2xl font-black text-blue-600">${p.answer}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // 修改設定按鈕
        document.getElementById('backBtn').addEventListener('click', () => {
            document.getElementById('configSection').classList.remove('hidden');
            document.getElementById('previewSection').classList.add('hidden');
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('printBtn').classList.add('hidden');
            window.scrollTo(0, 0);
        });

        // 列印按鈕
        document.getElementById('printBtn').addEventListener('click', () => {
            window.print();
        });
    </script>
</body>
</html>
